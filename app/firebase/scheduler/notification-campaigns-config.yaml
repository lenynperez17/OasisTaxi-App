# ðŸ“¢ CONFIGURACIÃ“N DE CLOUD SCHEDULER PARA CAMPAÃ‘AS DE NOTIFICACIONES
# OasisTaxi PerÃº - Sistema de CampaÃ±as Automatizadas con FCM
# 
# Este archivo define los trabajos de Cloud Scheduler para:
# - CampaÃ±as promocionales automÃ¡ticas
# - ReactivaciÃ³n de usuarios inactivos
# - Recordatorios de mantenimiento para conductores
# - Notificaciones de eventos especiales
# - CampaÃ±as de rating y feedback

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“± JOB 1: CAMPAÃ‘A PROMOCIONAL SEMANAL
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: "weekly-promo-campaign"
description: "CampaÃ±a promocional semanal para usuarios activos - OasisTaxi"
schedule: "0 10 * * 2" # Martes a las 10:00 AM (horario de mayor apertura de emails)
time_zone: "America/Lima"
target:
  pubsub_target:
    topic_name: "projects/oasis-taxi-peru/topics/notification-campaigns"
    data: |
      {
        "campaignType": "weekly_promo",
        "targetAudience": "active_users",
        "schedule": "weekly",
        "content": {
          "title": "Â¡Ofertas especiales esta semana! ðŸš–âœ¨",
          "body": "Descuentos del 20% en tus prÃ³ximos 3 viajes. Â¡Aprovecha ahora!",
          "imageUrl": "https://storage.googleapis.com/oasis-taxi-peru-assets/campaigns/weekly-promo.jpg",
          "actionUrl": "oasistaxi://promo/weekly",
          "promoCode": "SEMANA20"
        },
        "filters": {
          "userType": "passenger",
          "lastTripDays": 30,
          "minimumTrips": 1,
          "excludeInactive": true
        },
        "executedAt": "2024-01-01T10:00:00Z"
      }
retry_config:
  retry_count: 3
  max_retry_duration: "600s"
  min_backoff_duration: "10s"
  max_backoff_duration: "300s"

---

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ’¤ JOB 2: REACTIVACIÃ“N DE USUARIOS INACTIVOS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: "user-reactivation-campaign"
description: "CampaÃ±a de reactivaciÃ³n para usuarios inactivos hace 30+ dÃ­as - OasisTaxi"
schedule: "0 16 * * 5" # Viernes a las 4:00 PM (preparar fin de semana)
time_zone: "America/Lima"
target:
  pubsub_target:
    topic_name: "projects/oasis-taxi-peru/topics/notification-campaigns"
    data: |
      {
        "campaignType": "user_reactivation",
        "targetAudience": "inactive_users",
        "schedule": "weekly",
        "content": {
          "title": "Te extraÃ±amos en OasisTaxi ðŸ˜¢",
          "body": "Â¡Vuelve y recibe S/ 10 de descuento en tu prÃ³ximo viaje!",
          "imageUrl": "https://storage.googleapis.com/oasis-taxi-peru-assets/campaigns/comeback.jpg",
          "actionUrl": "oasistaxi://reactivation",
          "promoCode": "VUELVE10"
        },
        "filters": {
          "userType": "passenger",
          "lastTripDays": 30,
          "maxLastTripDays": 90,
          "excludeNew": true,
          "minimumHistoricalTrips": 3
        },
        "personalizedContent": {
          "includeLastTripDate": true,
          "includeFavoriteRoute": true,
          "includePreferredVehicleType": true
        },
        "executedAt": "2024-01-01T16:00:00Z"
      }
retry_config:
  retry_count: 2
  max_retry_duration: "300s"

---

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ”§ JOB 3: RECORDATORIOS DE MANTENIMIENTO PARA CONDUCTORES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: "driver-maintenance-reminders"
description: "Recordatorios de mantenimiento y documentos para conductores - OasisTaxi"
schedule: "0 9 1 * *" # Primer dÃ­a de cada mes a las 9:00 AM
time_zone: "America/Lima"
target:
  pubsub_target:
    topic_name: "projects/oasis-taxi-peru/topics/notification-campaigns"
    data: |
      {
        "campaignType": "driver_maintenance",
        "targetAudience": "active_drivers",
        "schedule": "monthly",
        "content": {
          "title": "Recordatorio mensual de mantenimiento ðŸ”§",
          "body": "Revisa que tu SOAT, licencia y revisiÃ³n tÃ©cnica estÃ©n vigentes",
          "imageUrl": "https://storage.googleapis.com/oasis-taxi-peru-assets/campaigns/maintenance.jpg",
          "actionUrl": "oasistaxi://driver/documents"
        },
        "filters": {
          "userType": "driver",
          "status": "active",
          "lastTripDays": 7
        },
        "personalizedContent": {
          "checkDocumentExpiry": true,
          "includeMaintenanceTips": true,
          "includeEarningsSummary": true
        },
        "urgentFilters": {
          "soatExpiringDays": 30,
          "licenseExpiringDays": 60,
          "technicalReviewExpiringDays": 45
        },
        "executedAt": "2024-01-01T09:00:00Z"
      }
retry_config:
  retry_count: 2
  max_retry_duration: "300s"

---

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸŽ‰ JOB 4: CAMPAÃ‘AS DE EVENTOS ESPECIALES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: "special-events-campaign"
description: "Notificaciones para eventos especiales y fechas importantes - OasisTaxi"
schedule: "0 8 * * *" # Diario a las 8:00 AM (chequea eventos del dÃ­a)
time_zone: "America/Lima"
target:
  pubsub_target:
    topic_name: "projects/oasis-taxi-peru/topics/notification-campaigns"
    data: |
      {
        "campaignType": "special_events",
        "targetAudience": "all_users",
        "schedule": "daily_check",
        "eventTypes": [
          {
            "type": "national_holidays",
            "events": [
              {"date": "2024-07-28", "name": "DÃ­a de la Independencia", "surge": 1.5},
              {"date": "2024-12-25", "name": "Navidad", "surge": 2.0},
              {"date": "2024-12-31", "name": "AÃ±o Nuevo", "surge": 2.5}
            ]
          },
          {
            "type": "local_events",
            "events": [
              {"date": "2024-10-18", "name": "SeÃ±or de los Milagros", "areas": ["Lima Centro", "Callao"]},
              {"date": "2024-08-30", "name": "Festival de Wong", "areas": ["Miraflores", "Barranco"]}
            ]
          },
          {
            "type": "weather_alerts",
            "conditions": ["lluvia_intensa", "neblina_densa", "vientos_fuertes"]
          }
        ],
        "content": {
          "holiday": {
            "title": "Â¡Feliz {holiday_name}! ðŸŽ‰",
            "body": "Mayor demanda esperada. Reserva tu viaje con anticipaciÃ³n",
            "actionUrl": "oasistaxi://book"
          },
          "weather": {
            "title": "Alerta climÃ¡tica âš ï¸",
            "body": "Condiciones climÃ¡ticas adversas. Viaja con precauciÃ³n",
            "actionUrl": "oasistaxi://safety"
          }
        },
        "executedAt": "2024-01-01T08:00:00Z"
      }
retry_config:
  retry_count: 1
  max_retry_duration: "120s"

---

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# â­ JOB 5: CAMPAÃ‘A DE RATING Y FEEDBACK
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: "rating-feedback-campaign"
description: "Recordatorios para calificar viajes y dar feedback - OasisTaxi"
schedule: "0 19 * * *" # Diario a las 7:00 PM (despuÃ©s del horario pico)
time_zone: "America/Lima"
target:
  pubsub_target:
    topic_name: "projects/oasis-taxi-peru/topics/notification-campaigns"
    data: |
      {
        "campaignType": "rating_feedback",
        "targetAudience": "recent_trip_users",
        "schedule": "daily",
        "content": {
          "rating_reminder": {
            "title": "Â¿CÃ³mo estuvo tu viaje? â­",
            "body": "Tu opiniÃ³n nos ayuda a mejorar. Califica tu experiencia",
            "actionUrl": "oasistaxi://rate/{trip_id}"
          },
          "feedback_request": {
            "title": "CuÃ©ntanos tu experiencia ðŸ’¬",
            "body": "Â¿Algo que podamos mejorar? Tu feedback es valioso",
            "actionUrl": "oasistaxi://feedback"
          },
          "thank_you": {
            "title": "Â¡Gracias por tu calificaciÃ³n! ðŸ™",
            "body": "Tu opiniÃ³n nos ayuda a brindar un mejor servicio",
            "rewards": true
          }
        },
        "filters": {
          "completedTripsLast24h": true,
          "unratedTrips": true,
          "excludeAlreadyNotified": true
        },
        "incentives": {
          "ratingReward": {
            "points": 50,
            "discount": "S/ 2 en prÃ³ximo viaje"
          },
          "detailedFeedbackReward": {
            "points": 100,
            "discount": "S/ 5 en prÃ³ximo viaje"
          }
        },
        "executedAt": "2024-01-01T19:00:00Z"
      }
retry_config:
  retry_count: 2
  max_retry_duration: "300s"

---

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸŽ¯ JOB 6: CAMPAÃ‘A PERSONALIZADA POR SEGMENTOS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: "personalized-segment-campaign"
description: "CampaÃ±as personalizadas por segmentos de usuarios - OasisTaxi"
schedule: "0 11 * * 3,6" # MiÃ©rcoles y sÃ¡bados a las 11:00 AM
time_zone: "America/Lima"
target:
  pubsub_target:
    topic_name: "projects/oasis-taxi-peru/topics/notification-campaigns"
    data: |
      {
        "campaignType": "personalized_segments",
        "targetAudience": "segmented_users",
        "schedule": "bi_weekly",
        "segments": [
          {
            "name": "frequent_business_users",
            "criteria": {
              "tripsPerMonth": 20,
              "averageDistance": 15,
              "preferredHours": ["07:00-09:00", "18:00-20:00"],
              "vehiclePreference": "premium"
            },
            "content": {
              "title": "Tu plan empresarial te espera ðŸ’¼",
              "body": "Descuentos especiales para usuarios frecuentes como tÃº",
              "promoCode": "BUSINESS25",
              "actionUrl": "oasistaxi://business-plan"
            }
          },
          {
            "name": "weekend_leisure_users",
            "criteria": {
              "tripsPerWeekend": 3,
              "averageDistance": 8,
              "popularDestinations": ["centros comerciales", "restaurantes", "cines"],
              "timePreference": "weekend"
            },
            "content": {
              "title": "Â¡Planes de fin de semana! ðŸŽŠ",
              "body": "Descuentos para tus salidas de recreaciÃ³n",
              "promoCode": "WEEKEND15",
              "actionUrl": "oasistaxi://weekend-deals"
            }
          },
          {
            "name": "airport_commuters",
            "criteria": {
              "airportTripsPerMonth": 4,
              "bookingAdvance": 2,
              "preferredVehicle": "van",
              "luggageRequirement": true
            },
            "content": {
              "title": "Viajero frecuente detectado âœˆï¸",
              "body": "Servicios premium para tus viajes al aeropuerto",
              "promoCode": "AIRPORT20",
              "actionUrl": "oasistaxi://airport-service"
            }
          }
        ],
        "executedAt": "2024-01-01T11:00:00Z"
      }
retry_config:
  retry_count: 3
  max_retry_duration: "600s"

---

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸš¨ JOB 7: NOTIFICACIONES DE EMERGENCIA Y ALERTAS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: "emergency-alerts-campaign"
description: "Sistema de alertas de emergencia y notificaciones crÃ­ticas - OasisTaxi"
schedule: "*/30 * * * *" # Cada 30 minutos (monitoreo continuo)
time_zone: "America/Lima"
target:
  pubsub_target:
    topic_name: "projects/oasis-taxi-peru/topics/notification-campaigns"
    data: |
      {
        "campaignType": "emergency_alerts",
        "targetAudience": "all_active_users",
        "schedule": "continuous",
        "alertTypes": [
          {
            "type": "service_disruption",
            "triggers": ["system_outage", "payment_issues", "map_service_down"],
            "content": {
              "title": "InterrupciÃ³n del servicio âš ï¸",
              "body": "Estamos trabajando para resolver el problema. Disculpa las molestias",
              "actionUrl": "oasistaxi://status",
              "priority": "high"
            }
          },
          {
            "type": "security_alert",
            "triggers": ["suspicious_activity", "fraud_detection", "safety_incident"],
            "content": {
              "title": "Alerta de seguridad ðŸ”’",
              "body": "Hemos detectado actividad sospechosa. Verifica tu cuenta",
              "actionUrl": "oasistaxi://security",
              "priority": "critical"
            }
          },
          {
            "type": "area_restriction",
            "triggers": ["traffic_closure", "event_restriction", "emergency_zone"],
            "content": {
              "title": "RestricciÃ³n de zona ðŸš«",
              "body": "Acceso restringido en {area_name}. Rutas alternativas disponibles",
              "actionUrl": "oasistaxi://restrictions",
              "priority": "medium"
            }
          },
          {
            "type": "driver_sos",
            "triggers": ["driver_emergency_button", "passenger_emergency_button"],
            "content": {
              "title": "Alerta de emergencia activada ðŸš¨",
              "body": "Se ha activado el botÃ³n de emergencia. Autoridades notificadas",
              "actionUrl": "oasistaxi://emergency/{trip_id}",
              "priority": "critical",
              "recipients": ["emergency_contacts", "support_team"]
            }
          }
        ],
        "executedAt": "2024-01-01T00:00:00Z"
      }
retry_config:
  retry_count: 5
  max_retry_duration: "300s"
  min_backoff_duration: "5s"
  max_backoff_duration: "60s"

---

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ”§ COMANDOS PARA CREAR LOS JOBS EN GOOGLE CLOUD
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. CAMPAÃ‘A PROMOCIONAL SEMANAL
gcloud scheduler jobs create pubsub weekly-promo-campaign \
  --location=us-central1 \
  --schedule="0 10 * * 2" \
  --time-zone="America/Lima" \
  --topic="notification-campaigns" \
  --message-body='{"campaignType":"weekly_promo","targetAudience":"active_users"}' \
  --description="CampaÃ±a promocional semanal para usuarios activos - OasisTaxi" \
  --max-retry-attempts=3 \
  --max-retry-duration=600s

# 2. REACTIVACIÃ“N DE USUARIOS
gcloud scheduler jobs create pubsub user-reactivation-campaign \
  --location=us-central1 \
  --schedule="0 16 * * 5" \
  --time-zone="America/Lima" \
  --topic="notification-campaigns" \
  --message-body='{"campaignType":"user_reactivation","targetAudience":"inactive_users"}' \
  --description="CampaÃ±a de reactivaciÃ³n para usuarios inactivos - OasisTaxi" \
  --max-retry-attempts=2 \
  --max-retry-duration=300s

# 3. RECORDATORIOS DE MANTENIMIENTO
gcloud scheduler jobs create pubsub driver-maintenance-reminders \
  --location=us-central1 \
  --schedule="0 9 1 * *" \
  --time-zone="America/Lima" \
  --topic="notification-campaigns" \
  --message-body='{"campaignType":"driver_maintenance","targetAudience":"active_drivers"}' \
  --description="Recordatorios de mantenimiento para conductores - OasisTaxi" \
  --max-retry-attempts=2 \
  --max-retry-duration=300s

# 4. EVENTOS ESPECIALES
gcloud scheduler jobs create pubsub special-events-campaign \
  --location=us-central1 \
  --schedule="0 8 * * *" \
  --time-zone="America/Lima" \
  --topic="notification-campaigns" \
  --message-body='{"campaignType":"special_events","targetAudience":"all_users"}' \
  --description="Notificaciones para eventos especiales - OasisTaxi" \
  --max-retry-attempts=1 \
  --max-retry-duration=120s

# 5. RATING Y FEEDBACK
gcloud scheduler jobs create pubsub rating-feedback-campaign \
  --location=us-central1 \
  --schedule="0 19 * * *" \
  --time-zone="America/Lima" \
  --topic="notification-campaigns" \
  --message-body='{"campaignType":"rating_feedback","targetAudience":"recent_trip_users"}' \
  --description="Recordatorios para calificar viajes - OasisTaxi" \
  --max-retry-attempts=2 \
  --max-retry-duration=300s

# 6. CAMPAÃ‘AS PERSONALIZADAS
gcloud scheduler jobs create pubsub personalized-segment-campaign \
  --location=us-central1 \
  --schedule="0 11 * * 3,6" \
  --time-zone="America/Lima" \
  --topic="notification-campaigns" \
  --message-body='{"campaignType":"personalized_segments","targetAudience":"segmented_users"}' \
  --description="CampaÃ±as personalizadas por segmentos - OasisTaxi" \
  --max-retry-attempts=3 \
  --max-retry-duration=600s

# 7. ALERTAS DE EMERGENCIA
gcloud scheduler jobs create pubsub emergency-alerts-campaign \
  --location=us-central1 \
  --schedule="*/30 * * * *" \
  --time-zone="America/Lima" \
  --topic="notification-campaigns" \
  --message-body='{"campaignType":"emergency_alerts","targetAudience":"all_active_users"}' \
  --description="Sistema de alertas de emergencia - OasisTaxi" \
  --max-retry-attempts=5 \
  --max-retry-duration=300s

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“‹ VERIFICACIÃ“N Y MONITOREO
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Listar todos los jobs de campaÃ±as
gcloud scheduler jobs list --location=us-central1 --filter="name:*campaign*"

# Ver detalles de una campaÃ±a especÃ­fica
gcloud scheduler jobs describe weekly-promo-campaign --location=us-central1

# Ejecutar manualmente una campaÃ±a (para pruebas)
gcloud scheduler jobs run weekly-promo-campaign --location=us-central1

# Ver logs de ejecuciÃ³n de campaÃ±as
gcloud logging read "resource.type=cloud_scheduler_job AND resource.labels.job_id:*campaign*" --limit=20 --format=json

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ”„ TÃ“PICOS PUBSUB NECESARIOS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Crear tÃ³pico principal de campaÃ±as
gcloud pubsub topics create notification-campaigns

# Crear tÃ³picos para diferentes tipos de notificaciones
gcloud pubsub topics create fcm-notifications
gcloud pubsub topics create email-notifications
gcloud pubsub topics create sms-notifications
gcloud pubsub topics create push-notifications

# Verificar tÃ³picos creados
gcloud pubsub topics list --filter="name:*notification*"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ›¡ï¸ PERMISOS Y CONFIGURACIÃ“N DE SEGURIDAD
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Permisos para Cloud Scheduler
gcloud projects add-iam-policy-binding oasis-taxi-peru \
  --member="serviceAccount:service-PROJECT_NUMBER@gcp-sa-cloudscheduler.iam.gserviceaccount.com" \
  --role="roles/pubsub.publisher"

# Permisos para Cloud Functions
gcloud projects add-iam-policy-binding oasis-taxi-peru \
  --member="serviceAccount:service-PROJECT_NUMBER@gcp-sa-cloudscheduler.iam.gserviceaccount.com" \
  --role="roles/cloudfunctions.invoker"

# Permisos para Firebase Messaging
gcloud projects add-iam-policy-binding oasis-taxi-peru \
  --member="serviceAccount:firebase-adminsdk-xyz@oasis-taxi-peru.iam.gserviceaccount.com" \
  --role="roles/firebase.messagingSender"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“Š MÃ‰TRICAS Y MONITOREO DE CAMPAÃ‘AS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Crear alertas para fallos en campaÃ±as crÃ­ticas
gcloud alpha monitoring policies create --policy-from-file=campaign-alerts.yaml

# Configurar mÃ©tricas personalizadas para engagement
gcloud logging metrics create campaign_success_rate \
  --description="Tasa de Ã©xito de campaÃ±as de notificaciones" \
  --log-filter='resource.type="cloud_function" AND textPayload:"campaign_sent"'

# Dashboard personalizado para campaÃ±as
# URL: https://console.cloud.google.com/monitoring/dashboards

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“ CONFIGURACIÃ“N DE A/B TESTING PARA CAMPAÃ‘AS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Firebase Remote Config para A/B testing
# Configurar en: https://console.firebase.google.com/project/oasis-taxi-peru/config

ab_testing_config:
  campaign_variations:
    promo_title_test:
      variant_a: "Â¡Ofertas especiales esta semana!"
      variant_b: "Â¡Descuentos increÃ­bles te esperan!"
      variant_c: "Â¡No te pierdas estas promociones!"
      allocation: "33.33% each"
      
    call_to_action_test:
      variant_a: "Aprovecha ahora"
      variant_b: "Reserva tu descuento"
      variant_c: "Ver ofertas"
      allocation: "33.33% each"
      
    send_time_test:
      variant_a: "10:00 AM"
      variant_b: "2:00 PM"
      variant_c: "6:00 PM"
      allocation: "33.33% each"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸŽ¯ SEGMENTACIÃ“N AVANZADA DE USUARIOS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

user_segments:
  behavioral:
    - high_frequency_users: "20+ viajes/mes"
    - occasional_users: "1-5 viajes/mes"
    - weekend_warriors: "80% viajes fin de semana"
    - business_commuters: "Lun-Vie 7-9AM, 5-7PM"
    
  geographic:
    - lima_metropolitana: "Dentro de Lima Metro"
    - provincia: "Fuera de Lima"
    - airport_frequent: "3+ viajes aeropuerto/mes"
    - mall_shoppers: "Destinos: centros comerciales"
    
  value_based:
    - premium_customers: "Viajes >S/50 promedio"
    - budget_conscious: "Viajes <S/20 promedio"
    - tip_generous: "Propinas >10%"
    - loyalty_members: "6+ meses activos"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“± PLANTILLAS DE CONTENIDO PERSONALIZADO
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

content_templates:
  spanish_formal: # Para usuarios business
    greeting: "Estimado {user_name}"
    tone: "formal"
    cta: "Solicite su viaje"
    
  spanish_casual: # Para usuarios jÃ³venes
    greeting: "Â¡Hola {user_name}!"
    tone: "amigable"
    cta: "Â¡Pide tu viaje ya!"
    
  spanish_premium: # Para usuarios VIP
    greeting: "Distinguido {user_name}"
    tone: "exclusivo"
    cta: "Reserve su servicio premium"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ† GAMIFICACIÃ“N EN CAMPAÃ‘AS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

gamification_elements:
  achievements:
    - eco_warrior: "10 viajes compartidos"
    - night_owl: "5 viajes despuÃ©s 11PM"
    - explorer: "Visita 20 distritos diferentes"
    - punctual: "95% viajes a tiempo"
    
  rewards:
    - streak_bonus: "7 dÃ­as consecutivos = descuento"
    - referral_points: "Invita amigos = puntos"
    - rating_rewards: "5 estrellas = beneficios"
    - milestone_prizes: "Viaje #100 = sorpresa"
    
  challenges:
    monthly: "30 viajes en el mes"
    seasonal: "Descubre 5 lugares nuevos"
    social: "Comparte tu experiencia"
    green: "Usa solo vehÃ­culos eco"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“ž INTEGRACIÃ“N CON CALL TO ACTION AVANZADOS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

advanced_cta:
  deep_links:
    - "oasistaxi://book?origin=last_destination"
    - "oasistaxi://promo?code={dynamic_code}"
    - "oasistaxi://driver/earnings?period=last_month"
    - "oasistaxi://passenger/history?filter=favorites"
    
  smart_suggestions:
    - weather_based: "Lluvia detectada â†’ Reservar viaje"
    - time_based: "Hora pico â†’ Pre-reservar"
    - location_based: "En aeropuerto â†’ Confirmar viaje"
    - event_based: "Concierto hoy â†’ Reservar regreso"
    
  contextual_actions:
    - "Repetir Ãºltimo viaje"
    - "Llamar al conductor asignado"
    - "Compartir ubicaciÃ³n con familia"
    - "Activar modo silencioso"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“ˆ ANÃLISIS DE PERFORMANCE DE CAMPAÃ‘AS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

performance_kpis:
  engagement:
    - open_rate: ">25%"
    - click_through_rate: ">8%"
    - conversion_rate: ">3%"
    - unsubscribe_rate: "<1%"
    
  business_impact:
    - trip_bookings_generated: "+15%"
    - revenue_attributed: "S/ 10,000/mes"
    - user_reactivation: "20% de inactivos"
    - driver_retention: "+10%"
    
  technical:
    - delivery_success_rate: ">99%"
    - processing_time: "<30s"
    - error_rate: "<0.1%"
    - bounce_rate: "<2%"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ”’ CUMPLIMIENTO Y PRIVACIDAD
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

privacy_compliance:
  gdpr_features:
    - consent_management: "Opt-in requerido"
    - data_retention: "24 meses mÃ¡ximo"
    - right_to_be_forgotten: "Eliminar en 30 dÃ­as"
    - data_portability: "Exportar datos usuario"
    
  peru_data_protection:
    - ley_29733_compliance: "Ley de ProtecciÃ³n Datos Personales"
    - consent_forms: "Consentimiento explÃ­cito"
    - data_controller: "OasisTaxi PerÃº SAC"
    - user_rights: "Acceso, rectificaciÃ³n, cancelaciÃ³n"
    
  opt_out_mechanisms:
    - global_unsubscribe: "Todas las campaÃ±as"
    - category_preferences: "Solo promociones/solo alertas"
    - frequency_control: "MÃ¡ximo 1/dÃ­a, 3/semana"
    - quiet_hours: "No enviar 10PM-7AM"